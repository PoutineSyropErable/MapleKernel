# .clangd - Configuration for clangd language server
CompileFlags:
  Add:
    # Common flags for all kernel code
    - -ffreestanding
    - -nostdlib
    - -fno-exceptions
    - -fno-rtti
    - -Wall
    - -Wextra
    - -fno-builtin
    - -fno-stack-protector
    - -fno-common

# ============ Protected Mode Configuration ============
If:
  PathMatch: ^ProtectedMode/.*
CompileFlags:
  Add:
    # Protected mode specific
    - --target=i686-elf
    - -m32
    - -march=i686
    # Protected mode include directories
    - -IProtectedMode/kernel
    - -IProtectedMode/real16_wrappers
    - -IProtectedMode/realmode_functions
    - -IProtectedMode/gdt
    - -IProtectedMode/idt
    - -IProtectedMode/stdio
    - -IProtectedMode/stdlib
    - -IProtectedMode/other
    - -IProtectedMode/runtime_code_analysis
    - -IProtectedMode/cpu/
    - -IProtectedMode/cpu/multicore
    - -IProtectedMode/cpu/fpu
    - -IProtectedMode/cpu/control_registers
    - -IProtectedMode/cpu/cpuid
    - -IProtectedMode/cpu/gdt 
    - -IProtectedMode/cpu/idt
    - -IProtectedMode/cpu/pic
    - -IProtectedMode/cpu/apic
    - -IProtectedMode/drivers/ps2/
    - -IProtectedMode/drivers/ps2/controller
    - -IProtectedMode/drivers/ps2/mouse
    - -IProtectedMode/drivers/ps2/keyboard
    - -IProtectedMode/drivers/ps2/keyboard/cpp
    - -IProtectedMode/drivers/usb/controller
    - -IProtectedMode/z_otherLang/cpp/
    - -IProtectedMode/z_otherLang/zig/
    - -IProtectedMode/z_otherLang/rust/

# ============ Long Mode Configuration ============
If:
  PathMatch: ^LongMode/.*
CompileFlags:
  Add:
    # Long mode specific (64-bit)
    - --target=x86_64-elf
    - -m64
    - -march=x86-64
    - -mcmodel=kernel
    - -mno-red-zone
    - -fno-pie
    # Long mode include directories
    - -ILongMode/kernel64
    - -ILongMode/stdio
    - -IProtectedMode/LongModePrep
    - -I../ProtectedMode/LongModePrep

# ============ File Type Specific Overrides ============

# C files
If:
  PathMatch: .*\.c$
CompileFlags:
  Add:
    - -std=gnu23

# C headers
If:
  PathMatch: .*\.h$
CompileFlags:
  Add:
    - -std=gnu23

# C++ files
If:
  PathMatch: .*\.cpp$
CompileFlags:
  Add:
    - -std=gnu++23
    - -fno-exceptions
    - -fno-rtti

# C++ modules
If:
  PathMatch: .*\.cppm$
CompileFlags:
  Add:
    - -std=c++23
    - -fno-exceptions
    - -fno-rtti

# Realmode 16-bit code (protected mode only)
If:
  And:
    - PathMatch: ^ProtectedMode/realmode_functions/.*\.c$
    - PathMatch: ^ProtectedMode/.*
CompileFlags:
  Add:
    - -std=gnu99
    - -m16

# Zig files (clangd may not understand these, but we can set flags)
If:
  PathMatch: .*\.zig$
CompileFlags:
  Add:
    # Zig uses its own compiler, but we can set C-compatible flags
    - -x
    - zig

# ============ Additional Directory Specific Rules ============




# ============ General Settings ============
Hover:
  ShowAKA: Yes
  Expand: Yes

Diagnostics:
  ClangTidy:
    Add:
      - bugprone-*
      - performance-*
      - portability-*
      - readability-*
      - modernize-*

Index:
  Background: Skip

Completion:
  Smart: True
